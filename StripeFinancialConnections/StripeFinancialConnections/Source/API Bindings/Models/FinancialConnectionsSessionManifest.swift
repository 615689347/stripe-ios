//
// FinancialConnectionsSessionManifest.swift
//
// Generated by swagger-codegen
// https://github.com/swagger-api/swagger-codegen
//

import Foundation
import UIKit
@_spi(STP) import StripeCore
@_spi(STP) import StripeUICore

enum FinancialConnectionsPaymentMethodType: String, SafeEnumCodable, Equatable {
    case usBankAccount = "us_bank_account"
    case link = "link"
    case unparsable
}

struct FinancialConnectionsSessionManifest: Decodable {
    
    // MARK: - Types
    
    enum NextPane: String, SafeEnumCodable, Equatable {
        case accountPicker = "account_picker"
        case attachLinkedPaymentAccount = "attach_linked_payment_account"
        case authOptions = "auth_options"
        case consent = "consent"
        case institutionPicker = "institution_picker"
        case linkConsent = "link_consent"
        case linkLogin = "link_login"
        case manualEntry = "manual_entry"
        case manualEntrySuccess = "manual_entry_success"
        case networkingLinkLoginWarmup = "networking_link_login_warmup"
        case networkingLinkSignupPane = "networking_link_signup_pane"
        case networkingLinkVerification = "networking_link_verification"
        case partnerAuth = "partner_auth"
        case success = "success"
        case unexpectedError = "unexpected_error"
        case unparsable
        
        // client-side only panes
        case resetFlow = "reset_flow"
        case terminalError = "terminal_error"
    }
    
    enum AccountDisconnectionMethod: String, SafeEnumCodable, Equatable {
        case dashboard = "dashboard"
        case support = "support"
        case email = "email"
        case link = "link"
        case unparsable
    }
    
    // MARK: - Properties
    
    let accountholderIsLinkConsumer: Bool?
    let activeAuthSession: FinancialConnectionsAuthorizationSession?
    let activeInstitution: FinancialConnectionsInstitution?
    let allowManualEntry: Bool
    let businessName: String?
    let connectPlatformName: String?
    let consentRequired: Bool
    let customManualEntryHandling: Bool
    let disableLinkMoreAccounts: Bool
    let hostedAuthUrl: String
    let successUrl: String
    let cancelUrl: String
    let initialInstitution: FinancialConnectionsInstitution?
    let instantVerificationDisabled: Bool
    let institutionSearchDisabled: Bool
    let isLinkWithStripe: Bool?
    let isNetworkingUserFlow: Bool?
    let isStripeDirect: Bool?
    let livemode: Bool
    let manualEntryUsesMicrodeposits: Bool
    let nextPane: NextPane
    let permissions: [StripeAPI.FinancialConnectionsAccount.Permissions]
    let singleAccount: Bool
    let paymentMethodType: FinancialConnectionsPaymentMethodType?
    let accountDisconnectionMethod: AccountDisconnectionMethod?
    let isEndUserFacing: Bool?
}

// this is a client-side enum (doesn't come from server)
enum FinancialConnectionsPartner {
    case finicity
    case mx
    case trueLayer
    case wellsFargo
    
    var name: String {
        switch self {
        case .finicity:
            return "Finicity"
        case .mx:
            return "MX"
        case .trueLayer:
            return "TrueLayer"
        case .wellsFargo:
            return "Wells Fargo"
        }
    }
    
    var icon: UIImage? {
        switch self {
        case .finicity:
            return Image.finicity.makeImage()
        case .mx:
            return Image.mx.makeImage()
        case .wellsFargo:
            return nil // TODO(kgaidis): do we need a wells fargo icon?
        case .trueLayer:
            return nil // TODO(kgaidis): do we need a true layer icon?
        }
    }
}

struct FinancialConnectionsAuthorizationSession: Decodable {
    enum Flow: String, SafeEnumCodable, Equatable {
        case directWebview = "direct_webview"
        case finicityConnectV2Lite = "finicity_connect_v2_lite"
        case finicityConnectV2Oauth = "finicity_connect_v2_oauth"
        case finicityConnectV2OauthWebview = "finicity_connect_v2_oauth_webview"
        case finicityConnectV2OauthRedirect = "finicity_connect_v2_oauth_redirect"
        case mxConnect = "mx_connect"
        case mxOauth = "mx_oauth"
        case mxOauthWebview = "mx_oauth_webview"
        case testmode = "testmode"
        case testmodeOauth = "testmode_oauth"
        case testmodeOauthWebview = "testmode_oauth_webview"
        case truelayerEmbedded = "truelayer_embedded"
        case truelayerOauth = "truelayer_oauth"
        case wellsFargo = "wells_fargo"
        case unparsable
        
        func toPartner() -> FinancialConnectionsPartner? {
            switch self {
            case .finicityConnectV2Oauth:
                fallthrough
            case .finicityConnectV2OauthWebview:
                fallthrough
            case .finicityConnectV2Lite:
                fallthrough
            case .finicityConnectV2OauthRedirect:
                return .finicity
            case .mxConnect:
                fallthrough
            case .mxOauth:
                fallthrough
            case .mxOauthWebview:
                return .mx
            case .truelayerEmbedded:
                fallthrough
            case .truelayerOauth:
                return .trueLayer
            case .wellsFargo:
                return .wellsFargo
            case .directWebview:
                fallthrough
            case .testmode:
                fallthrough
            case .testmodeOauth:
                fallthrough
            case .testmodeOauthWebview:
                fallthrough
            case .unparsable:
                assertionFailure("Expected to never access \(self)")
                return nil
            }
        }
        
        func isOAuth() -> Bool {
            switch self {
            case .directWebview:
                fallthrough
            case .finicityConnectV2Oauth:
                fallthrough
            case .finicityConnectV2OauthWebview:
                fallthrough
            case .finicityConnectV2OauthRedirect:
                fallthrough
            case .mxOauth:
                fallthrough
            case .mxOauthWebview:
                fallthrough
            case .testmodeOauth:
                fallthrough
            case .testmodeOauthWebview:
                fallthrough
            case .truelayerEmbedded:
                fallthrough
            case .truelayerOauth:
                fallthrough
            case .wellsFargo:
                return true
                
            case .finicityConnectV2Lite:
                fallthrough
            case .mxConnect:
                fallthrough
            case .testmode:
                fallthrough
            case .unparsable:
                return false
            }
        }
    }

    let id: String
    let flow: Flow?
    let institutionSkipAccountSelection: Bool?
    let nextPane: FinancialConnectionsSessionManifest.NextPane
    let showPartnerDisclosure: Bool?
    let skipAccountSelection: Bool?
    let url: String?
}

struct FinancialConnectionsMixedOAuthParams: Decodable {
    let state: String
    let code: String?
    let status: String?
    let memberGuid: String?
    let error: String?
}

struct FinancialConnectionsAuthorizationSessionAccounts: Decodable {
    let data: [FinancialConnectionsPartnerAccount]
    let nextPane: FinancialConnectionsSessionManifest.NextPane
}

struct FinancialConnectionsPartnerAccount: Decodable {
    let id: String
    let name: String
    let displayableAccountNumbers: String?
    let linkedAccountId: String? // determines whether we show a "Linked" label
    let balanceAmount: Double?
    let currency: String?
    let supportedPaymentMethodTypes: [FinancialConnectionsPaymentMethodType]
    
    var balanceInfo: (balanceAmount: Double, currency: String)? {
        if let balanceAmount = balanceAmount, let currency = currency {
            return (balanceAmount, currency)
        } else {
            return nil
        }
    }
}

struct FinancialConnectionsDisabledPartnerAccount {
    let account: FinancialConnectionsPartnerAccount
    let disableReason: String
}

typealias MicrodepositVerificationMethod = FinancialConnectionsPaymentAccountResource.MicrodepositVerificationMethod
struct FinancialConnectionsPaymentAccountResource: Decodable {
    
    enum MicrodepositVerificationMethod: String, SafeEnumCodable, Equatable {
        case descriptorCode = "descriptor_code"
        case amounts = "amounts"
        case unparsable
    }

    let id: String
    let nextPane: FinancialConnectionsSessionManifest.NextPane
    let microdepositVerificationMethod: MicrodepositVerificationMethod?
    let eligibleForNetworking: Bool?
    let networkingSuccessful: Bool?
}
